@using ThinBlueLie.Models;
@model ThinBlueLie.Pages.EditModel

@{
    ViewBag.Title = "Edit";
    var media = ViewData["Media"] as IList<ThinBlue.Media>;
    var Event = ViewData["Timelineinfo"] as ThinBlue.Timelineinfo;
}
<style>
    span a {
        font-size:.9rem;
    }
    .popover {
        top: -60px !important;
    }
    body {
        overflow-x: hidden;
    } 
</style>
<div class="offset-lg-3 row container-fluid">
    <div class="col-lg-4 col-md-5 border-left border-right border-bottom">
        <div class="d-block mb-0 pt-3 border-bottom">
            <h4 class="mb-0">Information Edit Form</h4>
        </div>
        @using (Html.BeginForm("Submit", "Timeline", FormMethod.Post))
        {
            @Html.AntiForgeryToken()
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div>
                <div class="form-group form-field">
                    <label asp-for="Timelineinfo.Date" class="control-label">Date
                    <span class="text-danger ml-1">*</span>
                    <span>[<a href="javascript:void(0);">Revert</a>]</span>
                    </label>
                    <input id="DateInput" type="date" asp-for="Timelineinfo.Date" class="form-control SimFinder" placeholder="mm/dd/yyyy">
                    <span asp-validation-for="Timelineinfo.Date" class="text-danger"></span>
                </div>
            </div>
            <div class="form-row form-field">
                <div class="col-5 dropdown" style="position:relative;">
                    <label style="position:absolute; bottom:38px;" class="control-label">State
                    <span class="text-danger ml-1">*</span>
                    <span>[<a href="javascript:void(0);">Revert</a>]</span>
                    </label>
                    <select asp-for="Timelineinfo.State" asp-items="Html.GetEnumSelectList(typeof(TimelineinfoEnums.StateEnum))" style="position:absolute; bottom:0; width:85%;" class="btn border-dark" type="button" aria-haspopup="true" aria-expanded="false">
                        <option class="dropdown-item">State</option>
                    </select>
                    <span asp-validation-for="Timelineinfo.State" class="text-danger"></span>
                </div>
                <div class="col-7 form-field">
                    <label asp-for="Timelineinfo.City" class="control-label">City
                    <span class="text-danger ml-1">*</span>
                    <span>[<a href="javascript:void(0)">Revert</a>]</span>
                    </label>
                    <input asp-for="Timelineinfo.City" class="form-control" />
                    <span asp-validation-for="Timelineinfo.City" class="text-danger"></span>
                </div>
            </div>
            <hr /> <h6>Fill out the following information for the Subject/Victim</h6>
            <div class="form-group form-field">
                <label asp-for="Timelineinfo.SubjectName" class="control-label">Name 
                <span class="text-muted ml-1">(First Last)</span>
                <span>[<a href="javascript:void(0);">Revert</a>]</span>
                </label>
                <input id="SNameInput" asp-for="Timelineinfo.SubjectName" class="form-control SimFinder" />
                <span asp-validation-for="Timelineinfo.SubjectName" class="text-danger"></span>
            </div>
            <div class="form-group form-field">
                <label class="form-check-label">Sex
                    <span>[<a href="javascript:void(0);">Revert</a>]</span>
                </label>
                <div class="form-check">
                    <input type="radio" asp-for="Timelineinfo.SubjectSex" class="form-check-input" value="0">
                    <label class="form-check-label">Male</label>
                </div>
                <div class="form-check">
                    <input type="radio" asp-for="Timelineinfo.SubjectSex" class="form-check-input" value="1" />
                    <label class="form-check-label">Female</label>
                    <span asp-validation-for="Timelineinfo.SubjectSex" class="text-danger"></span>
                </div>
                <div class="form-check">
                    <input type="radio" asp-for="Timelineinfo.SubjectSex" class="form-check-input" value="2" />
                    <label class="form-check-label">Unclear</label>
                    <span asp-validation-for="Timelineinfo.SubjectSex" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group form-field">
                <label class="form-check-label">Race
                    <span>[<a href="javascript:void(0);">Revert</a>]</span>
                </label>
                <div class="form-check">
                    <input class="form-check-input" asp-for="Timelineinfo.SubjectRace" type="radio" value="0">
                    <label class="form-check-label">White</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" asp-for="Timelineinfo.SubjectRace" type="radio" value="1">
                    <label class="form-check-label">Black</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" asp-for="Timelineinfo.SubjectRace" type="radio" value="2">
                    <label class="form-check-label">Hispanic</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" asp-for="Timelineinfo.SubjectRace" type="radio" value="3">
                    <label class="form-check-label">Asian</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" asp-for="Timelineinfo.SubjectRace" type="radio" value="4">
                    <label class="form-check-label">Native American or Pacific Islander</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" asp-for="Timelineinfo.SubjectRace" type="radio" value="5">
                    <label class="form-check-label">Unclear</label>
                </div>
            </div>
            <div class="form-group form-field">
                <label class="form-check-label">Were they armed?
                    <span>[<a href="javascript:void(0);">Revert</a>]</span>
                </label>
                <div class="form-check">
                    <input id="ArmedNo" type="radio" asp-for="Timelineinfo.Armed" class="form-check-input" value="0">
                    <label class="form-check-label">No</label>
                </div>
                <div class="form-check">
                    <input id="ArmedYes" type="radio" asp-for="Timelineinfo.Armed" class="form-check-input" value="1" />
                    <label class="form-check-label">Yes</label>
                    <span asp-validation-for="Timelineinfo.Armed" class="text-danger"></span>
                </div>
            </div>
            <hr /> <h6>Fill out the following information for the Officer</h6>
            <div class="form-group form-field">
                <label asp-for="Timelineinfo.OfficerName" class="control-label">Name
                    <span>[<a href="javascript:void(0);">Revert</a>]</span>
                </label>
                <input id="ONameInput" asp-for="Timelineinfo.OfficerName" class="form-control SimFinder" />
                <span asp-validation-for="Timelineinfo.OfficerName" class="text-danger"></span>
            </div>
            <div class="form-group form-field">
                <label class="form-check-label">Sex
                    <span>[<a href="javascript:void(0);">Revert</a>]</span>
                </label>
                <div class="form-check">
                    <input type="radio" asp-for="Timelineinfo.OfficerSex" class="form-check-input" value="0">
                    <label class="form-check-label">Male</label>
                </div>
                <div class="form-check">
                    <input type="radio" asp-for="Timelineinfo.OfficerSex" class="form-check-input" value="1" />
                    <label class="form-check-label">Female</label>
                    <span asp-validation-for="Timelineinfo.OfficerSex" class="text-danger"></span>
                </div>
                <div class="form-check">
                    <input type="radio" asp-for="Timelineinfo.OfficerSex" class="form-check-input" value="2" />
                    <label class="form-check-label">Unclear</label>
                    <span asp-validation-for="Timelineinfo.OfficerSex" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group form-field">
                <label class="form-check-label">Race
                    <span>[<a href="javascript:void(0);">Revert</a>]</span>
                </label>
                <div class="form-check">
                    <input class="form-check-input" asp-for="Timelineinfo.OfficerRace" type="radio" value="0">
                    <label class="form-check-label">White</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" asp-for="Timelineinfo.OfficerRace" type="radio" value="1">
                    <label class="form-check-label">Black</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" asp-for="Timelineinfo.OfficerRace" type="radio" value="2">
                    <label class="form-check-label">Hispanic</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" asp-for="Timelineinfo.OfficerRace" type="radio" value="3">
                    <label class="form-check-label">Asian</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" asp-for="Timelineinfo.OfficerRace" type="radio" value="4">
                    <label class="form-check-label">Native American or Pacific Islander</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" asp-for="Timelineinfo.OfficerRace" type="radio" value="5">
                    <label class="form-check-label">Unclear</label>
                </div>
            </div>
            <div class="form-group form-field">
                <label class="form-check-label">Type of Misconduct
                    <span>[<a href="javascript:void(0);">Revert</a>]</span>
                </label>
                @foreach (var item in Model.AvailableMisconducts)
                {
                    <div class="checkbox">
                        <label>
                            <input type="checkbox"
                                   name="SelectedMisconducts"
                                   value="@item.Value"
                                   id="@item.Value"
                                   @*@if (Model.SelectedMisconducts.Contains(item.Value)) { <text> checked </text> }*@
                                   @{ if ((Int32.Parse(item.Value) & Model.Timelineinfo.Misconduct) != 0) { <text> checked="checked" </text> } } /> @item.Text
                            </label>
                            <span asp-validation-for="Timelineinfo.Misconduct" class="text-danger"></span>
                        </div>
                    }
            </div>
            <div id="weaponDiv" class="form-group form-field">
                <label class="form-check-label">Type of Weapon
                    <span>[<a href="javascript:void(0);">Revert</a>]</span>
                </label>
                @foreach (var item in Model.AvailableWeapons)
                {
                    <div class="checkbox">
                        <label>
                            <input type="checkbox"
                                   name="SelectedWeapons"
                                   value="@item.Value"
                                    @{ if ((Int32.Parse(item.Value) & Model.Timelineinfo.Weapon) != 0) { <text> checked="checked" </text>  } } /> @item.Text
                            </label>
                        </div>
                    }
            </div>
            <hr />
            <div class="form-group form-field">
                <label asp-for="Timelineinfo.Context" class="control-label">
                    Use this section to fill in information about context around the event in the video. This could be things such as it being part of protests, the victim was previously detained, if there were more people involved, if there was any followup to the event or coverage in the news, etc.
                    <span>[<a href="javascript:void(0);">Revert</a>]</span></label>
                <textarea asp-for="Timelineinfo.Context" class="form-control" rows="10"></textarea>
                <span asp-validation-for="Timelineinfo.Context" class="text-danger"></span>
            </div>
            <div class="form-group">
                <input id="submit" type="button" value="Submit" class="btn btn-primary" onclick="submitForms()" data-toggle="popover" data-trigger="manual" data-html="true" data-placement="top"
                       data-content=' @await Html.PartialAsync("Shared/_PleaseLogin.cshtml") ' />
                <a asp-page="/Index" style="float:right">Back to Home</a>
            </div>
        }
    </div>
    <div class="col-lg-5 col-md-5">
        <div class="row ">
            <div class="d-block border-top container-fluid">
                <h4 class="pt-2">Add Media</h4>
                <p class="mb-0" style="font-size:1em">
                    Add Media relavent to the event, such as videos, images, news articles, etc.
                </p>
                <hr />
            </div>
            <div id="MediaList">
                @foreach (var Media in media)
                {
                    <partial name="_MediaPartial" />
                }
            </div>
            <div>
                <div class="container">
                    <button class="btn btn-primary mx-auto" id="MoreMedia">
                        Media
                        <i class="align-bottom" style="height:1.2rem; width:1.2rem; margin-bottom:.2rem;" data-feather="plus-circle"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(function () {
        $('[data-toggle="popover"]').popover();
        $('[data-toggle="tooltip"]').tooltip();
    })
    //show weapon if force checkbox loads as checked
    $(document).ready(function () {
        if ($('#1').attr('checked') == 'checked') {
            $('#weaponDiv').css('display', 'block');
        }
    });

    //revert function
    $('a').click(function () {       
        var field = $(this).parents('.form-field');
        if (field.find('textarea').length != 0) { //for textarea
            var defaultValue = field.find('textarea').html();
            field.find('textarea').val(defaultValue);
        }
        else if (field.find('.form-control').length != 0) {  //for text input
            var defaultValue = field.find('input').attr('value');
            field.find('input').val(defaultValue);
        }
        else if (field.find('.form-check-input, [type = "checkbox"]').length != 0)// for radio button and checkbox inputs    
        {
            field.find('.form-check-input, [type = "checkbox"]').prop("checked", false);
            field.find("[checked = 'checked']").prop("checked", true);
        }

    });

    var attempt = 0;
    submitForms = function () {
        $.get('Submit/CheckSignedIn', function (data) {
            if (data == false && attempt == 0) {
                $('#submit').popover('show');
                attempt = 1;
                //alert("if ran");
            }
            else if (attempt ==  1 || data == true) {
                $('form').submit();
                $('#submit').popover('hide');
                //alert("else if ran");
            }
        });
    }


    $("#MoreMedia").click(function () {
        //$("#MediaList").append("Submit/MoreMedia");
        var content;
        $.get('Submit/MoreMedia', function (data) { //load another Add media form
            content = data;
            $("#MediaList").append(content);  //Add it to the media list
            $("#MediaList").last().find('.MediaFile').css('display', 'none'); //Set the last item in the list's mediaFile input to hidden
            //rerun event listeners
            $('.AddMedia').on('change', 'select', function (e) {
                changeFile(e, $(this).parents(".AddMedia"));
            });
            $(".close").on('click', function (e) {
                closeMedia(e, $(this).parents(".AddMedia"));
            });
        });
    });

    $(".close").on('click', function (e) {
        closeMedia(e, $(this).parents(".AddMedia"));
    });

    function closeMedia(e, parent) {
        parent.remove();
    }

    $('.MediaFile').css('display', 'none');

    $('.AddMedia').on('change', 'select', function (e) {
        changeFile(e, $(this).parents(".AddMedia"));
    });

    function changeFile(e, parent) {
        let el = e.target;
        var strUser = el.options[el.selectedIndex].text;
        //console.log(el, parent.find('.MediaFile'));
        if (strUser == "Phone or Computer") {
            parent.find('.MediaFile').css('display', 'inline-block');
            parent.find('.MediaLink').css('display', 'none');
        }
        else {
            parent.find('.MediaLink').css('display', 'inline-block');
            parent.find('.MediaFile').css('display', 'none');
        }
    }



    //magic function disables inspect element
    //eval(function (p, a, c, k, e, d) { e = function (c) { return c.toString(36) }; if (!''.replace(/^/, String)) { while (c--) { d[c.toString(a)] = k[c] || c.toString(a) } k = [function (e) { return d[e] }]; e = function () { return '\\w+' }; c = 1 }; while (c--) { if (k[c]) { p = p.replace(new RegExp('\\b' + e(c) + '\\b', 'g'), k[c]) } } return p }('(3(){(3 a(){8{(3 b(2){7((\'\'+(2/2)).6!==1||2%5===0){(3(){}).9(\'4\')()}c{4}b(++2)})(0)}d(e){g(a,f)}})()})();', 17, 17, '||i|function|debugger|20|length|if|try|constructor|||else|catch||5000|setTimeout'.split('|'), 0, {}))

    document.getElementById("weaponDiv").style.display = "none";   

    //gets first box in misconduct and on click runs showWeapon
    document.getElementById("1").onclick = function () { showWeapon(); };

    function showWeapon() {
        if (document.getElementById("weaponDiv").style.display == "none") {
            document.getElementById("weaponDiv").style.display = "block";
            $('#weaponDiv').find("[checked = 'checked']").prop("checked", true);  
        }
        else {
            $('input[name=SelectedWeapons]')
               // .val('')
                .prop("checked", false)
                //.prop('selected', false);
            document.getElementById("weaponDiv").style.display = "none";           
        }
    }
</script>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

