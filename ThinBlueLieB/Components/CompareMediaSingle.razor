@using DiffPlex.DiffBuilder.Model;
@using static DataAccessLibrary.Enums.MediaEnums
@using static ThinBlueLieB.Helper.Algorithms.LinkConverter
@using static ThinBlueLieB.Helper.Extensions.EnumExtensions 

<div class="row">
    <div class="col-6 @(Media.Item1 == null && Media.Item2 != null? "imaginary-item" : "") @(Media.Item1 != null && Media.Item2 == null? "deleted-item" : "")">
        @if (Media.Item1 != null)
        {
            <div class="row">
                <div class="col-5 information">
                    @if (Model != null)
                    {
                        <CompareLine Model="Model.OldText.Lines.FirstOrDefault()"></CompareLine>
                    }
                    else
                    {
                        @Media.Item1.Blurb
                    }
                    <div class="pl-4">
                        <span><b>Credit:</b> @((MarkupString)SimpleCompare(Media.Item1.Credit, Media.Item2?.Credit, true))</span>
                        <span>
                            <b>Source:</b>
                            @if (Media.Item1.SourceFrom != (byte)SourceFromEnum.Device)
                            {
                                <a href="@GetLinkFromData(Media.Item1)"> External Link</a>
                            }
                            else
                            {
                                <a href="@(@"/Uploads/" + Media.Item1.SourcePath)"> Internal Link</a>
                            }
                        </span>
                        <span><b>Source Type:</b> @((MarkupString)SimpleCompare(GetEnumDisplayName((SourceFromEnum)Media.Item1.SourceFrom), GetEnumDisplayName((SourceFromEnum)Media.Item2?.SourceFrom), true))</span>
                        <span><b>Gore:</b> @((MarkupString)SimpleCompare(Media.Item1.Gore == 1 ? "Yes" : "No", Media.Item2?.Gore == 1 ? "Yes" : "No", true))</span>
                        <span><b>Rank:</b> @((MarkupString)SimpleCompare(Media.Item1.Rank.ToString(), Media.Item2?.Rank.ToString(), true))</span>
                    </div>
                </div>
                <div class="col-7">
                    @* If the link between the two is different, one side is null *@
                    <img class="img-fluid rounded" src="@GetLinkFromData(Media.Item1)">
                </div>
            </div>
        }
    </div>
    <div class="col-6 @(Media.Item2 == null && Media.Item1 != null? "imaginary-item" : "") @(Media.Item1 == null && Media.Item2 != null? "inserted-item" : "")">

        @if (Media.Item2 != null)
        {
            <div class="row">
                <div class="col-5 information">
                    @if (Model != null)
                    {
                        <CompareLine Model="Model.NewText.Lines.FirstOrDefault()"></CompareLine>
                    }
                    else
                    {
                        @Media.Item2.Blurb
                    }
                    <div class="pl-4">
                        <span><b>Credit:</b> @((MarkupString)SimpleCompare(Media.Item1.Credit, Media.Item2?.Credit, false))</span>
                        <span>
                            <b>Source:</b>
                            @if (Media.Item2.SourceFrom != (byte)SourceFromEnum.Device)
                            {
                                <a href="@GetLinkFromData(Media.Item2)"> External Link</a>
                            }
                            else
                            {
                                <a href="@(@"/Uploads/" + Media.Item2.SourcePath)"> Internal Link</a>
                            }
                        </span>
                        <span><b>Source Type:</b> @((MarkupString)SimpleCompare(GetEnumDisplayName((SourceFromEnum)Media.Item1.SourceFrom), GetEnumDisplayName((SourceFromEnum)Media.Item2?.SourceFrom), false))</span>
                        <span><b>Gore:</b> @((MarkupString)SimpleCompare(Media.Item1.Gore == 1 ? "Yes" : "No", Media.Item2?.Gore == 1 ? "Yes" : "No", false))</span>
                        <span><b>Rank:</b> @((MarkupString)SimpleCompare(Media.Item1.Rank.ToString(), Media.Item2?.Rank.ToString(), false))</span>
                    </div>
                </div>
                <div class="col-7">
                    @* If the link between the two is different, one side is null *@
                    <img class="img-fluid rounded" src="@GetLinkFromData(Media.Item2)">
                </div>
            </div>
        }
    </div>
</div>

@code {
    [Parameter] public Tuple<Media, Media> Media { get; set; }

    [Parameter]
    public SideBySideDiffModel? Model { get; set; }
    protected override void OnParametersSet()
    {
        //if (Media.Item1 != null)
        //{
        //    displayMedia = mapper.Map<EditMedia, Media>(Media.Item1);
        //}
        //else
        //{
        //    displayMedia = mapper.Map<EditMedia, Media>(Media.Item2);
        //}
    }

    static string SimpleCompare(string? Old, string? New, bool IsOriginal)
    {
        if (Old == New)
        {
            return Old;
        }
        else
        {
            if (IsOriginal)
            {
                return "<del>" + Old + "</del>";
            }
            else
            {
                return "<ins>" + New + "</ins>";
            }
        }
    }
}
