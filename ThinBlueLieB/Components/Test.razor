@page "/test"
@using Syncfusion.Blazor.Buttons
@using System.ComponentModel.DataAnnotations;
@using Microsoft.AspNetCore.Mvc
@using ThinBlueLieB.Helper.Extensions
@using Syncfusion.Blazor.DropDowns
@using Microsoft.AspNetCore.Identity
@using DiffPlex.DiffBuilder;
@using DiffPlex.DiffBuilder.Model;
@inject ISideBySideDiffBuilder sideBySide
@inject RoleManager<IdentityRole> roleManager

<div class="w-75 mt-5 container">
    @*<SfDropDownList TItem="string" TValue="TimelineinfoEnums.RaceEnum?" PopupHeight="230px" Placeholder="Race" @bind-Value="@officer.Race" DataSource="@Races">
    </SfDropDownList>
    <h3>@officer.Race</h3>*@    
    <div class="row">
        @*<div class="col-6 px-4">
            <CascadingValue Value="true">
                <h5 class="border-bottom">Officer's information</h5>
                <CompareOfficer Model="Officerdiff.OldText" NewOfficer="newOfficer" OldOfficer="oldOfficer"></CompareOfficer>
                <h5 class="border-bottom">Subject's information</h5>
                <CompareSubject Model="Subjectdiff.OldText" NewSubject="newSubject" OldSubject="oldSubject"></CompareSubject>
            </CascadingValue>
        </div>
        <div class="col-6 px-4">
            <CascadingValue Value="false">
                <h5 class="border-bottom">Officer's information</h5>
                <CompareOfficer Model="Officerdiff.NewText" NewOfficer="newOfficer" OldOfficer="oldOfficer"></CompareOfficer>
                <h5 class="border-bottom">Subject's information</h5>
                <CompareSubject Model="Subjectdiff.NewText" OldSubject="oldSubject" NewSubject="newSubject"></CompareSubject>
            </CascadingValue>
        </div>*@
    </div>
    <div class="row">
        <CompareOfficer Model="Officerdiff" NewOfficers="newOfficers" OldOfficers="oldOfficers"></CompareOfficer>
    </div>
</div>

@code{
    public ViewOfficer officer { get; set; } = new ViewOfficer();
    protected override void OnInitialized()
    {
        officer.Race = TimelineinfoEnums.RaceEnum.Native;
        officer.Misconduct = new int[] { };

        foreach (var officer in oldOfficers.Union(newOfficers))
        {
            try{
                //try to compare officers with the same idOfficer and build a model off of that
                Officerdiff.Add(sideBySide.BuildDiffModel(officer.Name, newOfficers.Where(o => o.IdOfficer == officer.IdOfficer).First().Name));
            }
            catch (Exception){
                Officerdiff.Add(new SideBySideDiffModel());
            }
        }
        foreach (var subject in oldSubjects)
        {
            try{
                //try to compare officers with the same idOfficer and build a model off of that
                Subjectdiff.Add(sideBySide.BuildDiffModel(subject.Name, newSubjects.Where(o => o.IdSubject == subject.IdSubject).First().Name));
            }
            catch (Exception){
                Subjectdiff.Add(new SideBySideDiffModel());
            }
        }
    }
    List<DBOfficer> oldOfficers = new List<DBOfficer>
    {
        //new DBOfficer{
        //IdOfficer = 1,
        //Name = "Man Smith",
        //Age = 59,
        //Race = TimelineinfoEnums.RaceEnum.White,
        //Sex = TimelineinfoEnums.SexEnum.Unclear,
        //Misconduct = 174,
        //Weapon = 39
        //},
        new DBOfficer{
        IdOfficer = 2,
        Name = "John Aladda",
        Age = 29,
        Race = TimelineinfoEnums.RaceEnum.White,
        Sex = TimelineinfoEnums.SexEnum.Unclear,
        Misconduct = 135,
        Weapon = 65
        }
    };
    List<DBOfficer> newOfficers = new List<DBOfficer>
    {
        //new DBOfficer{
        //IdOfficer = 3,
        //Name = "Dude Man",
        //Age = 19,
        //Race = TimelineinfoEnums.RaceEnum.White,
        //Sex = TimelineinfoEnums.SexEnum.Unclear,
        //Misconduct = 84,
        //Weapon = 16
        //},
        new DBOfficer{
        IdOfficer = 2,
        Name = "Jonathan Aledda",
        Age = 30,
        Race = TimelineinfoEnums.RaceEnum.Hispanic,
        Sex = TimelineinfoEnums.SexEnum.Male,
        Misconduct = 89,
        Weapon = 64
         }
    };
    List<DBSubject> oldSubjects = new List<DBSubject>
    {
        new DBSubject{
        Name = "Charles Kensley",
        Age = 46,
        Race = TimelineinfoEnums.RaceEnum.Black,
        Sex = TimelineinfoEnums.SexEnum.Male,
        Armed = true
        }
    };
    List<DBSubject> newSubjects = new List<DBSubject>
    {
        new DBSubject{
        Name = "Charles Kinsey",
        Age = 47,
        Race = TimelineinfoEnums.RaceEnum.Black,
        Sex = TimelineinfoEnums.SexEnum.Male,
        Armed = false
        }
    };
    private List<SideBySideDiffModel> Officerdiff = new List<SideBySideDiffModel>();
    private List<SideBySideDiffModel> Subjectdiff = new List<SideBySideDiffModel>();

    public IEnumerable<string> Races = EnumExtensions.GetEnumDisplayNames<TimelineinfoEnums.RaceEnum>();
}
